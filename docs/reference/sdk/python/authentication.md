# Authentication module

This module is based on the OIDC standard protocol for authentication, and supports methods such as obtaining authentication address, authentication, obtaining tokens, checking tokens, and logging out. This module only supports calls on the server side.

```python
from authing import AuthenticationClient

authentication = AuthenticationClient(options) # Initialization

authentication.buildAuthUrl() # Generate user login link
authentication.getLoginStateByAuthCode() # Get user login status with authorization code
authentication.getUserInfo() # Get user identity information through Access Token
authentication.refreshLoginState() # Refresh user login status through Refresh Token and extend expiration time
authentication.buildLogoutUrl() # Generate logout URL
```

## Initialization

```python
from authing import AuthenticationClient

authentication = AuthenticationClient(options)
```

### Parameters

- `appId` \<String\> GenAuth application ID;
- `appSecret` \<String\> GenAuth application Secret;
- `host` \<String\> The user pool domain name corresponding to the application, such as pool.genauth.ai;
- `redirectUri` \<String\> The redirection target URL after authentication is completed. It will be verified during authentication and needs to be consistent with the settings of the console.
- `logoutRedirectUri` \<String\> The redirection target URL after logout is completed.
- `scope` \<String\> The resource permissions possessed by the token (the permissions requested by the application side to GenAuth), separated by spaces, the default is 'openid profile', and the successfully obtained permissions will appear in the scope field of the Access Token.
- `serverJWKS` \<String\> The JWKS public key of the server, used to verify the Token signature, by default, it will be automatically obtained from the JWKS endpoint of the server through a network request.
- `cookieKey` \<String\> The name of the cookie that stores the authentication context.

### Example

```python
authentication = AuthenticationClient(
    appId="62ba7bxxxxxd3b597d3",
    appSecret="69fed9edxxxxxfd522ce43dc6",
    host="xxxxx.genauth.ai",
    redirectUri="https://xxxxx.com"
)
```

## Generate user login link

```python
authentication.buildAuthUrl(options)
```

> Call the method to generate the user login link and return it to the client, triggering the login authentication process at the appropriate time.

### Parameters

- `scope` \<str\> The resource permissions that the token has (the permissions requested by the application side to GenAuth), overwriting the corresponding settings in the initialization parameters.
- `state` \<str\> Random string, optional, automatically generated by default.
- `nonce` \<str\> Random string, optional, automatically generated by default.
- `redirectUri` \<str\> The callback address, overwriting the corresponding settings in the initialization parameters.
- `forced` \<bool\> Force the login page to be displayed even if the user is already logged in.

### Example

```python
data = authentication.buildAuthUrl(scope="openid profile offline_access")
```

### Example data

```python
{'url': 'https://xxxxx.genauth.ai/oidc/auth?redirect_uri=https%3A%2F%2Fxxxxx.com&response_mode=query&response_type=code&client_id=62ba7b1dxxxxx597d3&scope=openid+profile+offline_access&state=7XKduDqxxxxxgjck3&nonce=NqlxxxxxZfJxVTU&prompt=consent', 'state': '7XKduDqxxxxxgjck3', 'nonce': 'NqlxxxxxZfJxVTU'}
```

## Get user login status using authorization code

```python
authentication.getLoginStateByAuthCode(code, redirectUri)
```

> Use the authorization code Code to get the user's login status information.

### Parameters

- `code` \<str\> Authorization code Code, the user's authorization code Code is sent to the callback address after successful authentication, and each Code can only be used once.
- `redirectUri` \<str\> The callback address passed in when initiating authentication.

### Example

```python
data = authentication.getLoginStateByAuthCode("H5Sm-cxxxHVTbqqcOO", "https://xxx.com")
```

### Example data

```python
{'accessToken': 'xxxxx', 'idToken': 'xxxxx', 'refreshToken': 'xxxxx', 'expireAt': 1209600, 'parsedIDToken': {'sub': '62946eexxxxx4ffab6', 'birthdate': None, 'family_name': None, 'gender': 'M', 'given_name': None, 'locale': None, 'middle_name': None, 'name': 'xxxxx', 'nickname': 'xxxxx', 'picture': 'https://i2.hdslb.com/bfs/face/xxxxxa411f5e5c7d3e9d366a.jpg@100Q.webp', 'preferred_username': None, 'profile': None, 'updated_at': '2022-06-30T06:24:28.934Z', 'website': None, 'zoneinfo': None, 'nonce': 'NqlL4bxxxxxfJxVTU', 'at_hash': 'AsSMPrxxxxxb1OXcg', 'aud': '62ba7b1dxxxxx3b597d3', 'exp': 1657780627, 'iat': 1656571027, 'iss': 'https://xxxxx.genauth.ai/oidc'}, 'parsedAccessToken': {'jti': 'mYDDY27xxxxx9nSy0', 'sub': '62946ee413xxxxx44ffab6', 'iat': 1656571027, 'exp': 1657780627, 'scope': 'openid offline_access profile', 'iss': 'https://xxxxx.genauth.ai/oidc',
'aud': '62ba7b1d1xxxxx3b597d3'}}
```

## Get user identity information using Access Token

```python
authentication.getUserInfo(accessToken)
```

> Use Access token to get user information.

### Parameters

- `accessToken` \<str\> Access token, the content of the Access token obtained using the authorization code Code. For details, please refer to [Using OIDC Authorization Code Mode](/federation/oidc/authorization-code/).

### Example

```python
data = authentication.getUserInfo("xxxxx")
```

### Example data

```python
{'sub': '62946xxxxxbcc44ffab6', 'birthdate': None, 'family_name': None, 'gender': 'M', 'given_name': None, 'locale': None, 'middle_name': None, 'name': 'xxxxx', 'nickname': 'xxxxx', 'picture': 'https://i2.hdslb.com/bfs/face/1f3fxxxxx05a411f5e5c7d3e9d366a.jpg@100Q.webp', 'preferred_username': None, 'profile': None, 'updated_at': '2022-06-30T06:24:28.934Z', 'website': None, 'zoneinfo': None}
```

Field explanation:

| Field name         | Translation                                                 |
| :----------------- | :---------------------------------------------------------- |
| sub                | Abbreviation of subject, unique identifier, usually user ID |
| name               | given name                                                  |
| given_name         | given name                                                  |
| family_name        | surname                                                     |
| middle_name        | middle name                                                 |
| nickname           | nickname                                                    |
| preferred_username | preferred name                                              |
| profile            | basic information                                           |
| picture            | avatar                                                      |
| website            | website link                                                |
| gender             | gender                                                      |
| birthdate          | birthday                                                    |
| zoneinfo           | time zone                                                   |
| locale             | region                                                      |
| updated_at         | information update time                                     |

## Refresh user login status using Refresh Token

```python
authentication.refreshLoginState(refreshToken)
```

> Use Refresh token to refresh user login status and extend the expiration time of accessToken.

### Parameters

- `refreshToken` \<str\> Refresh token, to obtain Refresh Token, you need to include offline_access in the scope parameter, and then you can obtain the refresh_token from the return value of the `authentication.getLoginStateByAuthCode` method.

### Example

```python
data = authentication.refreshLoginState("w7_gPfxxxxxovbv00")
```

### Example data

```python
{'accessToken': 'xxxxx', 'idToken': 'xxxxx', 'refreshToken': 'xxxxx', 'expireAt': 1209600, 'parsedIDToken': {'sub': '62946eexxxxx4ffab6', 'birthdate': None, 'family_name': None, 'gender': 'M', 'given_name': None, 'locale': None, 'middle_name': None, 'name': 'xxxxx', 'nickname': 'xxxxx', 'picture': 'https://i2.hdslb.com/bfs/face/xxxxxa411f5e5c7d3e9d366a.jpg@100Q.webp', 'preferred_username': None, 'profile': None, 'updated_at': '2022-06-30T06:24:28.934Z', 'website': None, 'zoneinfo': None, 'nonce': 'NqlL4bxxxxxfJxVTU', 'at_hash': 'AsSMPrxxxxxb1OXcg', 'aud': '62ba7b1dxxxxx3b597d3', 'exp': 1657780627, 'iat': 1656571027, 'iss': 'https://xxxxx.genauth.ai/oidc'}, 'parsedAccessToken': {'jti': 'mYDDY27xxxxx9nSy0', 'sub': '62946ee413xxxxx44ffab6', 'iat': 1656571027, 'exp': 1657780627, 'scope': 'openid offline_access profile', 'iss': 'https://xxxxx.genauth.ai/oidc',
'aud': '62ba7b1d1xxxxx3b597d3'}}
```

## Generate logout URL

```python
authentication.buildLogoutUrl(options)
```

> Generate logout URL.

### Parameters

- `idToken` \<str\> The ID Token obtained when the user logs in, used to invalidate the user's Token, recommended to be passed in.
- `redirectUri` \<str\> The target URL after logout, overwriting the corresponding settings in the initialization parameters.
- `state` \<str\> The intermediate state identifier passed to the target URL.

### Example

```python
data = authentication.buildLogoutUrl()
```

### Example data

```python
"https://xxxxx.genauth.ai/oidc/session/end?"
```
